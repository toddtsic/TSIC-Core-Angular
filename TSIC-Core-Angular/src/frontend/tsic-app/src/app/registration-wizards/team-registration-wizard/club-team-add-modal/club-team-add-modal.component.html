@if (visible()) {
<div class="modal d-block" tabindex="-1" role="dialog"
    style="background-color: rgba(0,0,0,0.6); backdrop-filter: blur(2px);">
    <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
        <div class="modal-content border-0 shadow-lg">
            <div class="modal-header bg-primary text-white border-0">
                <div class="d-flex align-items-start w-100">
                    <i class="bi bi-plus-circle-fill me-2 mt-1 flex-shrink-0"></i>
                    <h4 class="modal-title mb-0 flex-grow-1 fs-5 fs-md-4">
                        Add Team to Club Team Library
                    </h4>
                </div>
                <button type="button" class="btn-close btn-close-white flex-shrink-0" (click)="close()"
                    aria-label="Close"></button>
            </div>
            <div class="modal-body p-3 p-md-4">
                @if (errorMessage()) {
                <div class="alert alert-danger alert-dismissible fade show mb-3" role="alert">
                    <i class="bi bi-exclamation-triangle me-2"></i>{{ errorMessage() }}
                    <button type="button" class="btn-close" (click)="errorMessage.set(null)"></button>
                </div>
                }

                <div class="info-section p-3 rounded-3 mb-3">
                    <div class="accordion" id="addTeamAccordion">
                        <!-- Guidelines Section -->
                        <div class="accordion-item border-2">
                            <h2 class="accordion-header">
                                <button class="accordion-button" type="button" [class.collapsed]="guidelinesCollapsed"
                                    (click)="guidelinesCollapsed = !guidelinesCollapsed"
                                    [attr.aria-expanded]="!guidelinesCollapsed" aria-controls="guidelinesCollapse">
                                    <i class="bi bi-info-circle text-primary fs-4 me-2 fw-bold"></i>
                                    <span class="fw-bold">Club Team Library Guidelines</span>
                                </button>
                            </h2>
                            <div id="guidelinesCollapse" class="accordion-collapse collapse"
                                [class.show]="!guidelinesCollapsed">
                                <div class="accordion-body">
                                    <ul class="mb-0 small ps-3">
                                        <li><strong>DO NOT REPEAT YOUR CLUB NAME</strong> in your team name</li>
                                        <li><strong>Once created, this team will be available for registration in all
                                                future
                                                events</strong>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <!-- Existing Teams Section -->
                        <div class="accordion-item border-2 mt-2">
                            <h2 class="accordion-header">
                                <button class="accordion-button" type="button"
                                    [class.collapsed]="existingTeamsCollapsed"
                                    (click)="existingTeamsCollapsed = !existingTeamsCollapsed"
                                    [attr.aria-expanded]="!existingTeamsCollapsed"
                                    aria-controls="existingTeamsCollapse">
                                    <i class="bi bi-info-circle text-primary fs-4 me-2 fw-bold"></i>
                                    <span class="fw-bold">Existing Teams ({{ teams().length }})</span>
                                </button>
                            </h2>
                            <div id="existingTeamsCollapse" class="accordion-collapse collapse"
                                [class.show]="!existingTeamsCollapsed">
                                <div class="accordion-body existing-teams-body">
                                    @if (teams().length === 0) {
                                    <p class="mb-0 small text-muted fst-italic">No teams in library yet</p>
                                    } @else {
                                    <div class="mt-2 small existing-teams-table">
                                        <!-- Header Row -->
                                        <div class="row g-0 mb-2 fw-bold border-bottom pb-1 existing-teams-header">
                                            <div class="col-1 text-center">#</div>
                                            <div class="col-5 ps-1">Team</div>
                                            <div class="col-4 ps-1">Grad Year</div>
                                            <div class="col-2 text-center text-nowrap">LOP</div>
                                        </div>
                                        <!-- Data Rows -->
                                        @for (team of teams(); track team.clubTeamId; let i = $index) {
                                        <div class="row g-0 py-1 align-items-center existing-teams-row">
                                            <div class="col-1 text-center text-muted">{{ i + 1 }}</div>
                                            <div class="col-5 ps-1">{{ team.clubTeamName }}</div>
                                            <div class="col-4 ps-1 text-muted">{{ team.clubTeamGradYear }}</div>
                                            <div class="col-2 text-center text-muted text-nowrap">{{
                                                team.clubTeamLevelOfPlay }}/5</div>
                                        </div>
                                        }
                                    </div>
                                    }
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-section p-3 rounded-3">
                    <form #addTeamForm="ngForm" (ngSubmit)="addNewClubTeam({
                    clubTeamName: teamName.value,
                    clubTeamGradYear: teamGradYear.value,
                    clubTeamLevelOfPlay: teamLevelOfPlay.value
                }, addTeamForm)">
                        <div class="row g-3">
                            <!-- All 3 fields equal width on desktop -->
                            <div class="col-12 col-md-4">
                                <label for="teamName" class="form-label fw-semibold mb-1">
                                    <i class="bi bi-pencil-square text-primary me-1"></i>
                                    Team Name <span class="text-danger">*</span>
                                </label>
                                <input id="teamName" #teamName="ngModel" ngModel name="teamName" type="text"
                                    class="form-control placeholder-subtle" placeholder="e.g., U12 Boys Elite" required
                                    maxlength="80"
                                    [class.is-invalid]="teamName.invalid && (teamName.touched || addTeamForm.submitted)" />
                                <small class="form-text text-muted">Do not include your club name</small>
                                @if (teamName.invalid && (teamName.touched || addTeamForm.submitted)) {
                                <div class="invalid-feedback">
                                    @if (teamName.errors?.['required']) { Team name is required }
                                    @if (teamName.errors?.['maxlength']) { Team name cannot exceed 80 characters }
                                </div>
                                }
                            </div>

                            <!-- Graduation Year & Level of Play - All 3 on one line in web view -->
                            <div class="col-12 col-md-4">
                                <label for="teamGradYear" class="form-label fw-semibold mb-1">
                                    <i class="bi bi-calendar-event text-success me-1"></i>
                                    Graduation Year <span class="text-danger">*</span>
                                </label>
                                <select id="teamGradYear" #teamGradYear="ngModel" ngModel name="teamGradYear"
                                    class="form-select placeholder-subtle" required
                                    [class.is-invalid]="teamGradYear.invalid && (teamGradYear.touched || addTeamForm.submitted)">
                                    <option value="" class="text-muted fst-italic">Select year...</option>
                                    @for (year of gradYearOptions(); track year) {
                                    <option [value]="year">{{ year }}</option>
                                    }
                                </select>
                                @if (teamGradYear.invalid && (teamGradYear.touched || addTeamForm.submitted)) {
                                <div class="invalid-feedback">Graduation year is required</div>
                                }
                            </div>

                            <div class="col-12 col-md-4">
                                <label for="teamLevelOfPlay" class="form-label fw-semibold mb-1">
                                    <i class="bi bi-graph-up-arrow text-warning me-1"></i>
                                    Level of Play <span class="text-danger">*</span>
                                </label>
                                <select id="teamLevelOfPlay" #teamLevelOfPlay="ngModel" ngModel name="teamLevelOfPlay"
                                    class="form-select placeholder-subtle" required maxlength="50"
                                    [class.is-invalid]="teamLevelOfPlay.invalid && (teamLevelOfPlay.touched || addTeamForm.submitted)">
                                    <option value="" class="text-muted fst-italic">Select level...</option>
                                    @for (level of levelOfPlayOptions(); track level.value) {
                                    <option [value]="level.value">{{ level.label }}</option>
                                    }
                                </select>
                                @if (teamLevelOfPlay.invalid && (teamLevelOfPlay.touched || addTeamForm.submitted)) {
                                <div class="invalid-feedback">
                                    @if (teamLevelOfPlay.errors?.['required']) { Level of play is required }
                                    @if (teamLevelOfPlay.errors?.['maxlength']) { Level of play cannot exceed 50
                                    characters }
                                </div>
                                }
                            </div>
                        </div>

                        <div class="mt-3 pt-3 border-top">
                            <div class="d-flex justify-content-center flex-nowrap gap-2">
                                <button type="button" class="btn btn-outline-secondary btn-compact" (click)="close()">
                                    <i class="bi bi-x-circle me-1"></i> Cancel
                                </button>
                                <button type="submit" class="btn btn-primary btn-compact"
                                    (mousedown)="stayOpenOnSubmit = false">
                                    <i class="bi bi-arrow-left-circle me-1"></i> Add and return
                                </button>
                                <button type="submit" class="btn btn-outline-primary btn-compact"
                                    (mousedown)="stayOpenOnSubmit = true">
                                    <i class="bi bi-plus-circle me-1"></i> Add and continue
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
}