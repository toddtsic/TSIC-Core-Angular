<main class="container py-4" aria-labelledby="rw-title" [wizardTheme]="'player'">
    <div class="row justify-content-center">
        <div class="col-lg-9 col-xl-8">
            <div class="card shadow-lg border-0 card-rounded mb-4">
                <div class="card-header gradient-header text-center py-4 border-0">
                    <h2 id="rw-title" class="mb-0 fw-bold">Player Registration</h2>
                    <div class="mt-2">
                        <span
                            class="badge rounded-pill bg-warning-subtle text-warning-emphasis border border-warning-subtle px-3 py-2 text-nowrap shadow-sm d-inline-flex align-items-center gap-2"
                            aria-live="polite">
                            <i class="bi bi-question-circle" aria-hidden="true"></i>
                            <span class="fw-bold">{{ stepLabels[steps()[currentIndex()]] }}</span>
                            <span class="opacity-75">(Step {{ currentIndex() + 1 }} of {{ steps().length }})</span>
                        </span>
                    </div>
                </div>
            </div>

            <div class="rw-sticky-header mb-4">
                <progress class="w-100 mb-2 rw-progress" [value]="progressPercent()" max="100">{{ progressPercent()
                    }}%</progress>
                <!-- Step tabs hidden intentionally to save space; single header badge above provides context -->

                <nav class="rw-toolbar rw-action-bar" aria-label="Wizard actions">
                    <div class="d-flex align-items-center justify-content-between flex-nowrap gap-2 flex-grow-1">
                        @if (familyLastName()) {
                        <div class="text-truncate me-2" title="Family account">
                            <span
                                class="badge bg-warning-subtle text-warning-emphasis border border-warning-subtle px-2 py-1 small">
                                {{ familyLastName() }} Family
                            </span>
                        </div>
                        }
                        <div class="action-buttons-highlight">
                            <div class="btn-group btn-group-sm action-buttons">
                                <button type="button" class="btn btn-secondary d-inline-flex align-items-center gap-2"
                                    (click)="back()" [disabled]="currentIndex() === 0"
                                    aria-label="Go back to previous step">
                                    <span class="dir-icon" aria-hidden="true">‹</span>
                                    <span>Back</span>
                                </button>
                                @if (showContinueButton()) {
                                <button type="button"
                                    class="btn btn-primary d-inline-flex align-items-center gap-2 fw-semibold proceed-btn"
                                    (click)="onContinue()" [disabled]="!canContinue()">
                                    {{ continueLabel() }}
                                    <span class="dir-icon" aria-hidden="true">›</span>
                                </button>
                                }
                            </div>
                        </div>
                    </div>
                </nav>
            </div>

            @switch (currentStepId()) {
            @case ('family-check') {
            <app-rw-family-check (next)="next()" />
            }
            @case ('players') {
            <app-rw-player-selection (next)="next()" />
            }
            @case ('eligibility') {
            <app-rw-eligibility-selection (back)="back()" (next)="next()" />
            }
            @case ('teams') {
            <app-rw-team-selection (back)="back()" (next)="next()" [multiSelect]="isMultiTeamMode()" />
            }
            @case ('forms') {
            <app-rw-player-forms (back)="back()" (next)="next()" />
            }
            @case ('waivers') {
            <app-rw-waivers (back)="back()" (next)="next()" />
            }
            @case ('review') {
            <app-rw-review (back)="back()" (next)="proceedToPayment()" />
            }
            @case ('payment') {
            <app-rw-payment (back)="back()" (submitted)="next()" />
            }
            @case ('confirmation') {
            <app-rw-confirmation (completed)="next()" />
            }
            @default {
            <div class="alert alert-warning" role="note">
                Unknown step "{{ currentStepId() }}". Please go back and try again.
            </div>
            }
            }
        </div>
    </div>

</main>