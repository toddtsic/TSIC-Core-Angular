<main aria-labelledby="select-role-title" [attr.aria-busy]="isLoading()" [wizardTheme]="'role-select'">
  <div class="container py-5">
    <div class="row justify-content-center">
      <div class="col-lg-8 col-xl-7">

        <div class="card shadow-lg border-0 card-rounded mb-4">
          <div class="card-header gradient-header text-center py-4 border-0">
            <h2 id="select-role-title" class="mb-0 fw-bold">Select Your Role</h2>
            <p class="mb-0 mt-2 opacity-75 small">Choose how you'd like to participate</p>
          </div>
        </div>

        @if (errorMessage()) {
        <mat-card appearance="outlined" class="mb-4 error-card" role="alert" aria-live="polite">
          <div class="d-flex align-items-center">
            <mat-icon color="warn" fontIcon="error" class="me-2"></mat-icon>
            <div><strong>Error:</strong> {{ errorMessage() }}</div>
          </div>
        </mat-card>
        }

        @if (isLoading() && !registrations().length) {
        <div class="card shadow border-0 card-rounded">
          <div class="card-body text-center py-5">
            <output class="d-block" aria-live="polite">
              <mat-progress-spinner mode="indeterminate" diameter="36" class="mb-3"
                aria-label="Loading registrations"></mat-progress-spinner>
              <p class="text-secondary mb-0">Loading your registrations...</p>
            </output>
          </div>
        </div>
        }

        @if (registrations() && registrations().length > 0) {
        <div class="role-groups">
          @for (roleGroup of registrations(); track roleGroup.roleName; let i = $index) {
          <div class="card shadow border-0 card-rounded mb-4">
            <div class="card-header card-header-subtle border-0 py-3">
              <h5 class="mb-0 fw-semibold">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="me-2"
                  viewBox="0 0 16 16">
                  <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0z" />
                  <path fill-rule="evenodd"
                    d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1z" />
                </svg>
                {{ roleGroup.roleName }}
              </h5>
            </div>
            <div class="card-body">
              <ejs-dropdownlist [dataSource]="roleGroup.roleRegistrations" [fields]="fields"
                [placeholder]="'Search and select ' + roleGroup.roleName + ' registration...'" [allowFiltering]="true"
                [filterBarPlaceholder]="'Type to search...'" [enabled]="!isLoading()" [popupHeight]="'350px'"
                [popupWidth]="'100%'"
                [htmlAttributes]="{ 'aria-label': 'Search and select ' + roleGroup.roleName + ' registration', 'aria-describedby': 'rs-help-' + i }"
                (filtering)="onFiltering($event, roleGroup)" (change)="onDropdownChange($event)">
                <ng-template #itemTemplate let-data>
                  <div class="dropdown-item-custom">
                    @if (data.jobLogo) {
                    <img class="job-logo" [src]="data.jobLogo" [alt]="data.displayText" />
                    }
                    <span class="item-text">{{ data.displayText }}</span>
                  </div>
                </ng-template>
              </ejs-dropdownlist>
              <span class="visually-hidden" [id]="'rs-help-' + i">Use search to filter registrations. Arrow keys
                navigate, Enter selects.</span>
            </div>
          </div>
          }
        </div>
        }

        <div class="text-center mt-4">
          <button type="button" mat-stroked-button color="warn" class="rounded-pill px-4" (click)="logout()"
            [disabled]="isLoading()">
            <mat-icon class="me-2" fontIcon="logout"></mat-icon>
            Logout
          </button>
        </div>

      </div>
    </div>
  </div>
</main>