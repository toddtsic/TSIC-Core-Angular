<!-- Loading state -->
@if (isLoading()) {
<div class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading teams...</span>
    </div>
    <p class="mt-3 text-muted">Loading registration data...</p>
</div>
} @else {

<!-- Error message -->
@if (errorMessage()) {
<div class="alert alert-danger alert-dismissible fade show" role="alert">
    <strong>Error:</strong> {{ errorMessage() }}
    <button type="button" class="btn-close" (click)="errorMessage.set(null)" aria-label="Close"></button>
</div>
}

<!-- Main content -->
<div class="teams-step-container">
    <!-- Add Team Button -->
    <div class="mb-4 d-flex justify-content-between align-items-center">
        <h4 class="mb-0">Registered Teams</h4>
        <button type="button" class="btn btn-primary" (click)="openRegistrationModal()">
            <i class="bi bi-plus-circle-fill me-2 d-none d-sm-inline"></i><span class="d-sm-none">Add </span><span
                class="d-none d-sm-inline">Add New </span>Team
        </button>
    </div>

    <!-- Registered Teams List -->
    <div class="card border-0 shadow-sm">
        @if (registeredTeams().length === 0) {
        <div class="p-5 text-center text-muted">
            <i class="bi bi-inbox fs-1 d-block mb-3"></i>
            <p class="mb-2 fw-semibold">No teams registered yet</p>
            <p class="small mb-0">Click "Add New Team" to register your first team for this event.</p>
        </div>
        } @else {
        <div class="table-responsive">
            <table class="table table-sm mb-0">
                <thead class="table-light">
                    <tr>
                        <th class="text-uppercase fw-bold small">Team</th>
                        <th class="text-uppercase fw-bold small">Age Group</th>
                        <th class="text-uppercase fw-bold small d-none d-md-table-cell">Level</th>
                        <th class="text-uppercase fw-bold small text-end">Fee</th>
                        <th class="text-end"></th>
                    </tr>
                </thead>
                <tbody>
                    @for (team of registeredTeams(); track team.teamId) {
                    <tr>
                        <td class="fw-semibold">{{ team.teamName }}</td>
                        <td>{{ team.ageGroupName }}</td>
                        <td class="text-muted d-none d-md-table-cell">{{ team.levelOfPlay || 'N/A' }}</td>
                        <td class="text-end">{{ team.feeTotal | currency }}</td>
                        <td class="text-end">
                            @if (team.paidTotal === 0) {
                            <button type="button" class="btn btn-sm btn-outline-danger" (click)="unregisterTeam(team)"
                                title="Remove from event">
                                <i class="bi bi-x-circle me-1"></i>Remove
                            </button>
                            } @else {
                            <span class="badge bg-success">Paid</span>
                            }
                        </td>
                    </tr>
                    }
                </tbody>
            </table>
        </div>

        <!-- Stats footer -->
        <div class="card-footer bg-light border-top">
            <div class="row g-2">
                <div class="col-auto">
                    <span class="badge bg-primary-subtle text-primary">
                        <i class="bi bi-people-fill me-1"></i>Teams: {{ registeredTeams().length }}
                    </span>
                </div>
                <div class="col-auto d-none d-md-inline">
                    <span class="badge bg-secondary-subtle text-secondary">
                        <i class="bi bi-receipt me-1"></i>Fees: {{ financialSummary().feesTotal | currency }}
                    </span>
                </div>
                <div class="col-auto d-none d-md-inline">
                    <span class="badge bg-success-subtle text-success">
                        <i class="bi bi-check-circle-fill me-1"></i>Paid: {{ financialSummary().paidTotal | currency }}
                    </span>
                </div>
                <div class="col-auto d-none d-md-inline">
                    <span class="badge bg-warning-subtle text-warning">
                        <i class="bi bi-exclamation-triangle-fill me-1"></i>Owes: {{ (financialSummary().feesTotal -
                        financialSummary().paidTotal) |
                        currency }}
                    </span>
                </div>
                @if (financialSummary().balanceDue > 0) {
                <div class="col-auto">
                    <span class="badge bg-danger-subtle text-danger">
                        <i class="bi bi-exclamation-circle-fill me-1"></i>Due: {{ financialSummary().balanceDue |
                        currency }}
                    </span>
                </div>
                }
            </div>
        </div>
        }
    </div>
</div>

<!-- Registration Modal Component -->
<app-team-registration-modal [isOpen]="showRegistrationModal()" [suggestedTeamNames]="suggestedTeamNamesForModal()"
    [ageGroups]="ageGroups()" [availableLevelsOfPlay]="levelsOfPlayOptions()" [isRegistering]="isRegistering()"
    (closed)="closeRegistrationModal()" (register)="onTeamRegistered($event)" (addAnother)="onTeamAddedAnother($event)">
</app-team-registration-modal>

}