<main class="container-fluid px-3 py-2 rw-wizard-container" aria-labelledby="rw-title" [wizardTheme]="'player'">
  <div class="row justify-content-center">
    <div class="col-12">
      <!-- Fixed header region containing title, step indicator, and action bar -->
      <div class="wizard-fixed-header">
        <div class="text-center mb-3">
          <h2 id="rw-title" class="mb-1 fw-bold">Player Registration</h2>
          <div class="step-info d-flex align-items-center justify-content-center flex-wrap gap-2">
            <p class="text-muted mb-0 fs-6">Step {{ currentIndex() + 1 }} of {{ steps().length }}</p>
            @if (familyLastName()) {
            <span class="badge bg-warning-subtle text-warning-emphasis border border-warning-subtle px-2 py-1 small">
              {{ familyLastName() }} Family
            </span>
            }
          </div>
        </div>

        <!-- Step indicator with circular badges -->
        <div class="mb-1">
          <app-step-indicator [steps]="stepDefinitions()" [currentIndex]="currentIndex()" />
        </div>

        <!-- Action bar (sticky via parent container) -->
        @if (currentIndex() !== 0) {
        <div class="wizard-action-bar-container">
          <app-wizard-action-bar [canBack]="currentIndex() !== 0" [canContinue]="canContinue()"
            [continueLabel]="continueLabel()" [showContinue]="showContinueButton()" (back)="back()"
            (continue)="onContinue()" />
        </div>
        }
      </div>

      <!-- Scrollable content region -->
      <div class="wizard-scrollable-content">
        <div class="mb-4">
          <div class="px-4 pb-4 pt-3">
            @switch (currentStepId()) {
            @case ('family-check') {
            <app-rw-family-check (next)="next()" />
            }
            @case ('players') {
            <app-rw-player-selection (next)="next()" />
            }
            @case ('eligibility') {
            <app-rw-eligibility-selection (back)="back()" (next)="next()" />
            }
            @case ('teams') {
            <app-rw-team-selection (back)="back()" (next)="next()" [multiSelect]="isMultiTeamMode()" />
            }
            @case ('forms') {
            <app-rw-player-forms (back)="back()" (next)="next()" />
            }
            @case ('waivers') {
            <app-rw-waivers (back)="back()" (next)="next()" />
            }
            @case ('review') {
            <app-rw-review (back)="back()" (next)="proceedToPayment()" />
            }
            @case ('payment') {
            <app-rw-payment (back)="back()" (submitted)="next()" />
            }
            @case ('confirmation') {
            <app-rw-confirmation (completed)="finishToJobHome()" />
            }
            @default {
            <div class="alert alert-warning" role="note">
              Unknown step "{{ currentStepId() }}". Please go back and try again.
            </div>
            }
            }
          </div>
        </div>
      </div> <!-- /wizard-scrollable-content -->

    </div> <!-- /col -->
  </div> <!-- /row -->
</main>