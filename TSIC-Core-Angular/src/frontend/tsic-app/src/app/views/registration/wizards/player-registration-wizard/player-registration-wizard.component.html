<main class="container-fluid px-3 py-2 rw-wizard-container" aria-labelledby="rw-title" [wizardTheme]="'player'">
  <div class="row justify-content-center">
    <div class="col-12">
      <!-- Fixed header region containing title, step indicator, and action bar -->
      <div class="wizard-fixed-header">
        <!-- Mobile: Ultra-compact title -->
        <div class="d-md-none text-center mb-1">
          <div class="d-flex align-items-center justify-content-center gap-2 flex-wrap">
            <h2 id="rw-title" class="mb-0 fw-bold fs-6">Player Registration</h2>
            @if (familyLastName()) {
            <span class="badge bg-warning-subtle text-warning-emphasis border border-warning-subtle px-2 py-1 small">
              {{ familyLastName() }}
            </span>
            }
          </div>
        </div>

        <!-- Desktop: Full title -->
        <div class="d-none d-md-block text-center mb-3">
          <h2 id="rw-title" class="mb-1 fw-bold">Player Registration</h2>
          @if (familyLastName()) {
          <div class="d-flex align-items-center justify-content-center">
            <span class="badge bg-warning-subtle text-warning-emphasis border border-warning-subtle px-2 py-1 small">
              {{ familyLastName() }} Family
            </span>
          </div>
          }
        </div>

        <!-- Step indicator (responsive: compact bar on mobile, full badges on desktop) -->
        <div class="mb-1">
          <app-step-indicator [steps]="stepDefinitions()" [currentIndex]="currentIndex()" />
        </div>

        <!-- Action bar (sticky via parent container) -->
        @if (currentIndex() !== 0) {
        <div class="wizard-action-bar-container">
          <app-wizard-action-bar [canBack]="currentIndex() !== 0" [canContinue]="canContinue()"
            [continueLabel]="continueLabel()" [showContinue]="showContinueButton()" (back)="back()"
            (continue)="onContinue()" />
        </div>
        }
      </div>

      <!-- Scrollable content region -->
      <div class="wizard-scrollable-content">
        <div class="mb-4">
          <div class="px-4 pb-4 pt-3">
            @switch (currentStepId()) {
            @case ('family-check') {
            <app-rw-family-check (next)="next()" />
            }
            @case ('players') {
            <app-rw-player-selection (next)="next()" />
            }
            @case ('eligibility') {
            <app-rw-eligibility-selection (back)="back()" (next)="next()" />
            }
            @case ('teams') {
            <app-rw-team-selection (back)="back()" (next)="next()" [multiSelect]="isMultiTeamMode()" />
            }
            @case ('forms') {
            <app-rw-player-forms (back)="back()" (next)="next()" />
            }
            @case ('waivers') {
            <app-rw-waivers (back)="back()" (next)="next()" />
            }
            @case ('review') {
            <app-rw-review (back)="back()" (next)="proceedToPayment()" />
            }
            @case ('payment') {
            <app-rw-payment (back)="back()" (submitted)="next()" />
            }
            @case ('confirmation') {
            <app-rw-confirmation (completed)="finishToJobHome()" />
            }
            @default {
            <div class="alert alert-warning" role="note">
              Unknown step "{{ currentStepId() }}". Please go back and try again.
            </div>
            }
            }
          </div>
        </div>
      </div> <!-- /wizard-scrollable-content -->

    </div> <!-- /col -->
  </div> <!-- /row -->
</main>