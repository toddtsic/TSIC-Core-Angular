<main aria-labelledby="select-role-title" [attr.aria-busy]="isLoading()">
  <div class="container py-5">
    <div class="row justify-content-center">
      <div class="col-lg-8 col-xl-7">

        <div class="card shadow-lg border-0 card-rounded mb-4">
          <div class="role-header text-center border-0">
            <h2 id="select-role-title" class="mb-0 fw-bold">Select Your Role</h2>
            <p class="mb-0 mt-2 small">Choose how you'd like to participate</p>
            @if (username()) {
            <span class="username-badge mt-3">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" class="me-1"
                viewBox="0 0 16 16">
                <path d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6m2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0m4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4m-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10s-3.516.68-4.168 1.332c-.678.678-.83 1.418-.832 1.664z"/>
              </svg>
              {{ username() }}
            </span>
            }
          </div>

          <div class="card-body">
            @if (errorMessage()) {
            <div class="alert alert-danger border-0 shadow-sm mb-4" role="alert">
              <strong>Error:</strong> {{ errorMessage() }}
            </div>
            }

            @if (isLoading() && !registrations().length) {
            <div class="text-center py-5">
              <output class="d-block" aria-live="polite">
                <div class="spinner-border text-primary mb-3" aria-label="Loading registrations">
                  <span class="visually-hidden">Loading...</span>
                </div>
                <p class="text-muted mb-0">Loading your registrations...</p>
              </output>
            </div>
            }

            @if (registrations() && registrations().length > 0) {
            @for (roleGroup of registrations(); track roleGroup.roleName; let i = $index) {
            <div class="role-section" [class.mt-4]="i > 0">
              <span class="role-badge mb-3">
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" class="me-1"
                  viewBox="0 0 16 16">
                  <path d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6m2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0m4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4m-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10s-3.516.68-4.168 1.332c-.678.678-.83 1.418-.832 1.664z"/>
                </svg>
                {{ roleGroup.roleName }}
              </span>
              <ejs-dropdownlist [dataSource]="roleGroup.roleRegistrations" [fields]="fields"
                [placeholder]="'Search and select ' + roleGroup.roleName + ' registration...'" [allowFiltering]="true"
                [filterBarPlaceholder]="'Type to search...'" [enabled]="!isLoading()" [popupHeight]="'350px'"
                [popupWidth]="'100%'"
                [htmlAttributes]="{ 'aria-label': 'Search and select ' + roleGroup.roleName + ' registration', 'aria-describedby': 'rs-help-' + i }"
                (filtering)="onFiltering($event, roleGroup)" (change)="onDropdownChange($event)">
                <ng-template #itemTemplate let-data>
                  <div class="dropdown-item-custom">
                    @if (data.jobLogo) {
                    <img class="job-logo" [src]="data.jobLogo" [alt]="data.displayText" />
                    }
                    <span class="item-text">{{ data.displayText }}</span>
                  </div>
                </ng-template>
              </ejs-dropdownlist>
              <span class="visually-hidden" [id]="'rs-help-' + i">Use search to filter registrations. Arrow keys
                navigate, Enter selects.</span>
            </div>
            }
            }
          </div>
        </div>

        <div class="text-center mt-4">
          <button type="button" class="btn btn-outline-danger rounded-pill px-4" (click)="logout()"
            [disabled]="isLoading()">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="me-2"
              viewBox="0 0 16 16">
              <path fill-rule="evenodd"
                d="M10 12.5a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 .5.5v2a.5.5 0 0 0 1 0v-2A1.5 1.5 0 0 0 9.5 2h-8A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-2a.5.5 0 0 0-1 0v2z" />
              <path fill-rule="evenodd"
                d="M15.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 0 0-.708.708L14.293 7.5H5.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0 .708.708l3-3z" />
            </svg>
            Logout
          </button>
        </div>

      </div>
    </div>
  </div>
</main>