<div class="login-wrapper">
  <div class="card card-rounded login-card">
    <!-- Card Header with Gradient -->
    <div class="card-header text-center border-0 gradient-header login-header">
      <h2 class="login-title">{{ headerText }}</h2>
      <p class="login-subtitle">{{ subHeaderText }}</p>
    </div>

    <!-- Card Body -->
    <div class="card-body login-body">
      <form [formGroup]="form" (ngSubmit)="onSubmit($event)" autocomplete="on" name="login" id="login-form"
        method="post" action="/" novalidate>

        <div class="login-field">
          <label for="username" class="form-label fw-semibold">Username</label>
          <input #usernameInput id="username" name="username" type="text" class="form-control form-control-lg"
            formControlName="username" placeholder="Enter your username" autocomplete="username" aria-label="Username"
            [class.is-invalid]="submitted() && form.get('username')?.invalid">
          @if (submitted() && form.get('username')?.invalid) {
          <div class="invalid-feedback">
            Username is required
          </div>
          }
        </div>

        <div class="login-field">
          <label for="password" class="form-label fw-semibold">Password</label>
          <div class="position-relative">
            <input #passwordInput id="password" name="password" [type]="showPassword() ? 'text' : 'password'"
              class="form-control form-control-lg pe-5" formControlName="password"
              placeholder="Enter your password" [attr.autocomplete]="'current-password'" autocapitalize="none"
              spellcheck="false" aria-label="Password"
              [class.is-invalid]="submitted() && form.get('password')?.invalid">
            <button type="button" class="btn btn-link password-toggle"
              (click)="toggleShowPassword()"
              [attr.aria-label]="showPassword() ? 'Hide password' : 'Show password'" tabindex="-1">
              <i class="bi" [class.bi-eye]="!showPassword()" [class.bi-eye-slash]="showPassword()"></i>
            </button>
          </div>
          @if (submitted() && form.get('password')?.invalid) {
          <div class="invalid-feedback d-block">
            Password is required
          </div>
          }
        </div>

        @if (auth.loginError()) {
        <div class="alert alert-danger login-error">
          {{ auth.loginError() }}
        </div>
        }

        <button type="submit" class="btn btn-lg w-100 fw-semibold btn-gradient login-submit"
          [disabled]="auth.loginLoading() || form.invalid">
          @if (!auth.loginLoading()) {
          <span>Sign In</span>
          } @else {
          <span>
            <span class="spinner-border spinner-border-sm me-2"></span>
            Signing in...
          </span>
          }
        </button>

        <!-- Escape route: allow switching to generic login if this is a themed login -->
        @if (theme !== 'login') {
        <div class="text-center login-escape">
          <a [routerLink]="['/tsic/login']" [queryParams]="escapeQueryParams" class="small text-decoration-underline">
            Not your login type? Switch
          </a>
        </div>
        }
      </form>
    </div>
  </div>
</div>
