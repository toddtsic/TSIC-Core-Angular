<div class="profile-form-preview">
    @if (formGroup()) {
    <form [formGroup]="formGroup()!">
        <div class="row">
            @for (field of sortedFields(); track field.name) {
            <div class="col-md-6 mb-3">
                <div class="form-field-preview"
                    [class.bg-warning]="field.visibility === 'adminOnly'"
                    [class.bg-opacity-25]="field.visibility === 'adminOnly'"
                    [class.border-warning]="field.visibility === 'adminOnly'"
                    [class.border-2]="field.visibility === 'adminOnly'"
                    [class.admin-only]="field.visibility === 'adminOnly'"
                    [class.hidden-field]="isHiddenField(field)">
                    <!-- Field Label with Order Number -->
                    <label [for]="field.name" class="form-label">
                        @if (showFieldNumbers) {
                        <span class="badge bg-secondary me-2">{{ field.order }}</span>
                        }
                        <i class="bi {{ getFieldIcon(field) }} me-1"></i>
                        {{ field.displayName }}
                        @if (getVisibilityBadge(field); as badge) {
                        <span class="badge ms-2" [ngClass]="badge.class">{{ badge.label }}</span>
                        }
                        @if (field.computed) {
                        <span class="badge bg-info ms-2">Computed</span>
                        }
                    </label>

                    <!-- Validation Rules Summary - skip for hidden fields -->
                    @if (!isHiddenField(field)) {
                    <div class="mb-2">
                        <small class="text-muted">
                            <i class="bi bi-shield-check"></i> <strong>Validators:</strong>
                            @if (field.validation && getValidationHint(field)) {
                            {{ getValidationHint(field) }}
                            } @else {
                            <span class="text-muted fst-italic">None</span>
                            }
                        </small>
                    </div>
                    }

                    <!-- Input controls - skip for hidden fields, just render hidden input -->
                    @if (isHiddenField(field)) {
                    <input type="hidden" [id]="field.name" [formControlName]="field.name">
                    }

                    <!-- TEXT Input -->
                    @else if (field.inputType === 'TEXT' || field.inputType === 'EMAIL' || field.inputType === 'TEL') {
                    <input [type]="field.inputType === 'EMAIL' ? 'email' : field.inputType === 'TEL' ? 'tel' : 'text'"
                        class="form-control" [id]="field.name" [formControlName]="field.name"
                        [placeholder]="'Enter ' + field.displayName" [readonly]="readonly">
                    }

                    <!-- NUMBER Input -->
                    @else if (field.inputType === 'NUMBER') {
                    <input type="number" class="form-control" [id]="field.name" [formControlName]="field.name"
                        [placeholder]="'Enter ' + field.displayName" [min]="field.validation?.min ?? null"
                        [max]="field.validation?.max ?? null" [readonly]="readonly">
                    }

                    <!-- DATE Input -->
                    @else if (field.inputType === 'DATE') {
                    <input type="date" class="form-control" [id]="field.name" [formControlName]="field.name"
                        [readonly]="readonly">
                    }

                    <!-- SELECT Input -->
                    @else if (field.inputType === 'SELECT') {
                    <select class="form-select" [id]="field.name" [formControlName]="field.name" [disabled]="readonly">
                        <option value="">-- Select {{ field.displayName }} --</option>
                        @for (option of getDropdownOptions(field); track option.value) {
                        <option [value]="option.value">{{ option.label }}</option>
                        }
                        @if (getDropdownOptions(field).length === 0) {
                        <option disabled>No options available</option>
                        }
                    </select>
                    }

                    <!-- CHECKBOX Input -->
                    @else if (field.inputType === 'CHECKBOX') {
                    <div class="form-check">
                        <input type="checkbox" class="form-check-input" [id]="field.name" [formControlName]="field.name"
                            [disabled]="readonly">
                        <label class="form-check-label" [for]="field.name">
                            {{ field.displayName }}
                        </label>
                    </div>
                    }

                    <!-- FILE Input -->
                    @else if (field.inputType === 'FILE') {
                    <input type="file" class="form-control" [id]="field.name" [disabled]="readonly">
                    <small class="text-muted">File upload field (preview only)</small>
                    }

                    <!-- Unknown Type -->
                    @else {
                    <input type="text" class="form-control" [id]="field.name" [formControlName]="field.name"
                        [placeholder]="'Unknown type: ' + field.inputType" [readonly]="readonly">
                    }
                </div>
            </div>
            }
        </div>
    </form>
    } @else {
    <div class="text-center py-4 text-muted">
        <i class="bi bi-inbox" style="font-size: 2rem;"></i>
        <p class="mt-2">No metadata to preview</p>
    </div>
    }
</div>