<div class="container-fluid py-4">
    <div class="row g-4">

        <!-- Admin Tools (Superuser Only) -->
        @if (authService.isSuperuser()) {
        <div class="col-12">
            <div class="card shadow-sm card-rounded border-primary">
                <div class="card-header bg-primary bg-opacity-10 border-0 py-3">
                    <h3 class="h4 mb-0 fw-semibold text-primary">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="me-2"
                            viewBox="0 0 16 16">
                            <path
                                d="M8 4.754a3.246 3.246 0 1 0 0 6.492 3.246 3.246 0 0 0 0-6.492zM5.754 8a2.246 2.246 0 1 1 4.492 0 2.246 2.246 0 0 1-4.492 0z" />
                            <path
                                d="M9.796 1.343c-.527-1.79-3.065-1.79-3.592 0l-.094.319a.873.873 0 0 1-1.255.52l-.292-.16c-1.64-.892-3.433.902-2.54 2.541l.159.292a.873.873 0 0 1-.52 1.255l-.319.094c-1.79.527-1.79 3.065 0 3.592l.319.094a.873.873 0 0 1 .52 1.255l-.16.292c-.892 1.64.901 3.434 2.541 2.54l.292-.159a.873.873 0 0 1 1.255.52l.094.319c.527 1.79 3.065 1.79 3.592 0l.094-.319a.873.873 0 0 1 1.255-.52l.292.16c1.64.893 3.434-.902 2.54-2.541l-.159-.292a.873.873 0 0 1 .52-1.255l.319-.094c1.79-.527 1.79-3.065 0-3.592l-.319-.094a.873.873 0 0 1-.52-1.255l.16-.292c.893-1.64-.902-3.433-2.541-2.54l-.292.159a.873.873 0 0 1-1.255-.52l-.094-.319z" />
                        </svg>
                        Admin Tools
                    </h3>
                </div>
                <div class="card-body">
                    <div class="row g-3">
                        <!-- Profile Migration Dashboard -->
                        <div class="col-md-6 col-lg-4">
                            <div class="card h-100 border-2 border-primary">
                                <div class="card-body text-center p-4 d-flex flex-column">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentColor"
                                        class="mb-3 text-primary" viewBox="0 0 16 16">
                                        <path
                                            d="M8.186 1.113a.5.5 0 0 0-.372 0L1.846 3.5l2.404.961L10.404 2l-2.218-.887zm3.564 1.426L5.596 5 8 5.961 14.154 3.5l-2.404-.961zm3.25 1.7-6.5 2.6v7.922l6.5-2.6V4.24zM7.5 14.762V6.838L1 4.239v7.923l6.5 2.6zM7.443.184a1.5 1.5 0 0 1 1.114 0l7.129 2.852A.5.5 0 0 1 16 3.5v8.662a1 1 0 0 1-.629.928l-7.185 2.874a.5.5 0 0 1-.372 0L.63 13.09a1 1 0 0 1-.63-.928V3.5a.5.5 0 0 1 .314-.464L7.443.184z" />
                                    </svg>
                                    <h5 class="card-title fw-bold mb-3">Profile Migration Dashboard</h5>
                                    <p class="text-muted mb-3">Migrate profile metadata from GitHub POCOs</p>
                                    <a [routerLink]="['/', jobPath(), 'admin', 'profile-migration']"
                                        class="btn btn-primary w-100 mt-auto">
                                        Open Migration
                                    </a>
                                </div>
                            </div>
                        </div>

                        <!-- Profile Metadata Editor -->
                        <div class="col-md-6 col-lg-4">
                            <div class="card h-100 border-2 border-primary">
                                <div class="card-body text-center p-4 d-flex flex-column">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentColor"
                                        class="mb-3 text-primary" viewBox="0 0 16 16">
                                        <path
                                            d="M9.405 1.05c-.413-1.4-2.397-1.4-2.81 0l-.1.34a1.464 1.464 0 0 1-2.105.872l-.31-.17c-1.283-.698-2.686.705-1.987 1.987l.169.311c.446.82.023 1.841-.872 2.105l-.34.1c-1.4.413-1.4 2.397 0 2.81l.34.1a1.464 1.464 0 0 1 .872 2.105l-.17.31c-.698 1.283.705 2.686 1.987 1.987l.311-.169a1.464 1.464 0 0 1 2.105.872l.1.34c.413 1.4 2.397 1.4 2.81 0l.1-.34a1.464 1.464 0 0 1 2.105-.872l.31.17c1.283.698 2.686-.705 1.987-1.987l-.169-.311a1.464 1.464 0 0 1 .872-2.105l.34-.1c1.4-.413 1.4-2.397 0-2.81l-.34-.1a1.464 1.464 0 0 1-.872-2.105l.17-.31c.698-1.283-.705-2.686-1.987-1.987l-.311.169a1.464 1.464 0 0 1-2.105-.872l-.1-.34zM8 10.93a2.929 2.929 0 1 1 0-5.86 2.929 2.929 0 0 1 0 5.858z" />
                                    </svg>
                                    <h5 class="card-title fw-bold mb-3">Profile Metadata Editor</h5>
                                    <p class="text-muted mb-3">Edit registration form fields and validation</p>
                                    <a [routerLink]="['/', jobPath(), 'admin', 'profile-editor']"
                                        class="btn btn-primary w-100 mt-auto">
                                        Open Editor
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        }

        <!-- Phase 1: Registration Options -->
        <div class="col-12">
            <div class="card shadow-sm card-rounded">
                <div class="card-header card-header-subtle border-0 py-3">
                    <h3 class="h4 mb-0 fw-semibold text-success">Registration</h3>
                </div>
                <div class="card-body">
                    @if (loading()) {
                    <div class="text-center py-5">
                        <output class="spinner-border text-success" aria-live="polite">
                            <span class="visually-hidden">Loading...</span>
                        </output>
                        <p class="text-muted mt-3">Loading registration information...</p>
                    </div>
                    } @else if (error()) {
                    <div class="alert alert-danger" role="alert">
                        <strong>Error:</strong> {{ error() }}
                    </div>
                    } @else {
                    <div class="row g-3">
                        <!-- Start Family Registration: force logout to avoid cross-user context -->
                        <div class="col-md-6 col-lg-4">
                            <div class="card h-100 border-2 border-success">
                                <div class="card-body text-center p-4 d-flex flex-column">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentColor"
                                        class="mb-3 text-success" viewBox="0 0 16 16">
                                        <path d="M8 2.354a2.5 2.5 0 1 0 0 4.292 2.5 2.5 0 0 0 0-4.292Z" />
                                        <path d="M14 14s-1 0-1-1-1-4-5-4-5 3-5 4-1 1-1 1h12Z" />
                                    </svg>
                                    <h5 class="card-title fw-bold mb-2">Start Family Registration</h5>
                                    <p class="text-muted mb-3">Create a new Family Account to begin</p>
                                    <button type="button" class="btn btn-success w-100 mt-auto"
                                        (click)="startFamilyRegistration()">
                                        Start Family Registration
                                    </button>
                                </div>
                            </div>
                        </div>
                        <!-- Family Account entry: edit existing (may prompt login) -->
                        <div class="col-md-6 col-lg-4">
                            <div class="card h-100 border-2 border-success">
                                <div class="card-body text-center p-4">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentColor"
                                        class="mb-3 text-success" viewBox="0 0 16 16">
                                        <path d="M8 2.354a2.5 2.5 0 1 0 0 4.292 2.5 2.5 0 0 0 0-4.292Z" />
                                        <path d="M14 14s-1 0-1-1-1-4-5-4-5 3-5 4-1 1-1 1h12Z" />
                                    </svg>
                                    <h5 class="card-title fw-bold mb-2">Family Account</h5>
                                    <p class="text-muted mb-3">Review or update your family and children</p>
                                    <a [routerLink]="['/tsic','family-account']"
                                        [queryParams]="{ mode: 'edit', returnUrl: '/' + jobPath() + '/home' }"
                                        class="btn btn-success w-100">
                                        Open Family Account
                                    </a>
                                </div>
                            </div>
                        </div>
                        @for (status of registrationStatuses(); track status.registrationType) {
                        <div class="col-md-6 col-lg-4">
                            <div class="card h-100 border-2" [class.border-success]="status.isAvailable"
                                [class.border-secondary]="!status.isAvailable">
                                <div class="card-body text-center p-4">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentColor"
                                        class="mb-3" [class.text-success]="status.isAvailable"
                                        [class.text-secondary]="!status.isAvailable" viewBox="0 0 16 16">
                                        <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0z" />
                                        <path fill-rule="evenodd"
                                            d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1z" />
                                    </svg>
                                    <h5 class="card-title fw-bold mb-3">{{ status.registrationType }} Registration</h5>

                                    @if (status.isAvailable) {
                                    <p class="text-muted mb-3">Registration is open</p>
                                    <!-- Primary: In-app Registration Wizard for Player registrations -->
                                    @if (status.registrationType === 'Player') {
                                    <button type="button" class="btn btn-success w-100 mb-2"
                                        (click)="startPlayerRegistration()">
                                        Start Registration Wizard
                                    </button>
                                    }
                                    <!-- Secondary: External/legacy registration URL when provided -->
                                    @if (status.registrationUrl) {
                                    <a [href]="status.registrationUrl" class="btn btn-outline-success w-100">
                                        Open Registration Page
                                    </a>
                                    }
                                    } @else {
                                    <p class="text-muted mb-0">{{ status.message }}</p>
                                    }
                                </div>
                            </div>
                        </div>
                        }
                    </div>
                    }
                </div>
            </div>
        </div>
    </div>
</div>