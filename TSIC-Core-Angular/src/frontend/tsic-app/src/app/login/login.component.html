<div class="container d-flex justify-content-center align-items-center py-5">
  <div class="card shadow-lg border-0 card-rounded">
    <!-- Card Header with Gradient -->
    <div class="card-header text-center py-4 border-0 gradient-header">
      <h2 class="mb-0 fw-bold">{{ headerText }}</h2>
      <p class="mb-0 mt-2 opacity-75 small">{{ subHeaderText }}</p>
    </div>

    <!-- Card Body -->
    <div class="card-body p-4">
      <form [formGroup]="form" (ngSubmit)="onSubmit($event)" autocomplete="on" name="login" id="login-form"
        method="post" action="/" novalidate>

        <div class="mb-4">
          <mat-form-field appearance="outline" class="w-100">
            <mat-label>Username</mat-label>
            <input #usernameInput matInput id="username" name="username" type="text" formControlName="username"
              placeholder="Enter your username" autocomplete="username" aria-label="Username">
            @if (submitted() && form.get('username')?.invalid) { <mat-error>Username is required</mat-error> }
          </mat-form-field>
        </div>

        <div class="mb-4">
          <mat-form-field appearance="outline" class="w-100">
            <mat-label>Password</mat-label>
            <input #passwordInput matInput id="password" name="password" [type]="showPassword() ? 'text' : 'password'"
              formControlName="password" placeholder="Enter your password" [attr.autocomplete]="'current-password'"
              autocapitalize="none" spellcheck="false" aria-label="Password">
            <button mat-icon-button matSuffix type="button" (click)="toggleShowPassword()"
              [attr.aria-label]="showPassword() ? 'Hide password' : 'Show password'">
              @if (!showPassword()) {
              <mat-icon fontIcon="visibility"></mat-icon>
              } @else {
              <mat-icon fontIcon="visibility_off"></mat-icon>
              }
            </button>
            @if (submitted() && form.get('password')?.invalid) { <mat-error>Password is required</mat-error> }
          </mat-form-field>
        </div>

        @if (auth.loginError()) {
        <mat-card appearance="outlined" class="mb-4 error-card" role="alert" aria-live="polite">
          <div class="d-flex align-items-center">
            <mat-icon color="warn" fontIcon="error" class="me-2"></mat-icon>
            <div>{{ auth.loginError() }}</div>
          </div>
        </mat-card>
        }

        <button type="submit" mat-raised-button color="primary" style="width:100%"
          [disabled]="auth.loginLoading() || form.invalid">
          @if (!auth.loginLoading()) {
          <span>Sign In</span>
          } @else {
          <span>
            <mat-progress-spinner mode="indeterminate" [diameter]="18" [strokeWidth]="3"
              class="me-2"></mat-progress-spinner>
            Signing in...
          </span>
          }
        </button>

        <!-- Escape route: allow switching to generic login if this is a themed login -->
        @if (theme !== 'login') {
        <div class="text-center mt-3">
          <a [routerLink]="['/tsic/login']" [queryParams]="escapeQueryParams" class="small text-decoration-underline">
            Not your login type? Switch
          </a>
        </div>
        }
      </form>
    </div>
  </div>
</div>