<!-- Header -->
<header class="tsic-header">
  <div class="container-fluid">
    <!-- Row 1: Logos + User Actions -->
    <div class="row align-items-center py-2 py-md-2 py-1">
      <!-- Left: Hamburger (mobile only) + TSIC + Job Logos (auto-width) -->
      <div class="col-auto d-flex align-items-center">
        <!-- Hamburger Menu Button (mobile only, visible when menus exist) -->
        @if (menus() && menus().length > 0) {
        <button type="button"
          class="btn btn-sm btn-outline-secondary me-2 d-md-none d-inline-flex align-items-center justify-content-center"
          style="width: 32px; height: 32px; padding: 0;" (click)="toggleSidebar()" [attr.aria-expanded]="sidebarOpen()"
          aria-label="Toggle navigation">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
            <path fill-rule="evenodd"
              d="M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5z" />
          </svg>
        </button>
        }
        <!-- Button group on mobile -->
        <div class="btn-group d-md-none">
          <button type="button" class="btn btn-sm btn-outline-secondary p-2" style="border-color: rgba(0,0,0,0.175);">
            <img src="images/tsic-notext-logo.png" alt="TSIC" style="height: 24px; display: block;" />
          </button>
          @if (jobLogoPath()) {
          <button type="button" class="btn btn-sm btn-outline-secondary p-2" style="border-color: rgba(0,0,0,0.175);">
            <img [src]="jobLogoPath()" alt="Job Logo" style="height: 24px; display: block;" />
          </button>
          }
        </div>

        <!-- Full layout on desktop -->
        <div class="d-none d-md-flex align-items-center gap-2">
          <!-- TSIC Logo with light background -->
          <div class="tsic-brand-container">
            <img src="images/tsic-logo.png" alt="TSIC" class="tsic-logo" />
          </div>

          <!-- Divider -->
          <div class="brand-divider"></div>

          <!-- Job Info Container (logo + name pill) -->
          <div class="job-brand-container d-flex align-items-center gap-2 flex-md-grow-1">
            @if (jobName()) {
            <button type="button"
              class="btn btn-sm btn-outline-secondary job-button d-inline-flex align-items-center gap-2 px-2 py-1"
              (click)="goHome()" [title]="jobName()">
              @if (jobLogoPath()) {
              <img [src]="jobLogoPath()" alt="Job Logo" class="job-logo-inline" />
              }
              <span class="job-name-text text-muted fw-medium">{{ jobName() }}</span>
            </button>
            }
          </div>
        </div>
      </div>

      <!-- Middle: Job Name (mobile only) -->
      <div class="col d-md-none">
        <div class="text-center">
          @if (jobName()) {
          <span class="fw-semibold text-success" style="font-size: 0.75rem;">{{ jobName() }}</span>
          }
        </div>
      </div>

      <!-- Right: User Actions (auto-width) -->
      <div class="col-auto">
        <div class="d-flex align-items-center justify-content-end gap-2">
          @if (username(); as u) {
          <span class="user-role-pill d-none d-md-inline">
            <span class="badge bg-user me-1">{{ u }}</span>
            @if (roleName(); as r) {
            <span class="text-muted small">as</span>
            <span class="badge bg-role ms-1">{{ r }}</span>
            }
          </span>
          }

          <!-- Button group on mobile, separate buttons on desktop -->
          <div class="btn-group d-md-none">
            <!-- Home -->
            <button type="button" class="btn btn-sm btn-outline-primary" (click)="goHome()" title="Home">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                <path
                  d="M8.354 1.146a.5.5 0 0 0-.708 0l-6 6a.5.5 0 1 0 .708.708L2 7.207V14.5A1.5 1.5 0 0 0 3.5 16h2A1.5 1.5 0 0 0 7 14.5V11h2v3.5A1.5 1.5 0 0 0 10.5 16h2a1.5 1.5 0 0 0 1.5-1.5V7.207l.646.647a.5.5 0 0 0 .708-.708l-6-6z" />
              </svg>
            </button>
            @if (showRoleMenu()) {
            <a role="button" class="btn btn-sm btn-outline-success" [routerLink]="['/tsic/role-selection']"
              (click)="onSwitchRole($event)" title="Switch Role">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                <path d="M1 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1H1zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6z" />
                <path fill-rule="evenodd"
                  d="M13.5 5a.5.5 0 0 1 .5.5V7h1.5a.5.5 0 0 1 0 1H14v1.5a.5.5 0 0 1-1 0V8h-1.5a.5.5 0 0 1 0-1H13V5.5a.5.5 0 0 1 .5-.5z" />
              </svg>
            </a>
            }
            <button type="button" class="btn btn-sm btn-outline-secondary" (click)="toggleTheme()" title="Toggle Theme">
              @if (themeService.theme() === 'light') {
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                <path
                  d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z" />
              </svg>
              } @else {
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                <path
                  d="M8 11a3 3 0 1 1 0-6 3 3 0 0 1 0 6zm0 1a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z" />
              </svg>
              }
            </button>
            @if (isAuthenticated()) {
            <button type="button" class="btn btn-sm btn-outline-danger" (click)="logout()" title="Logout">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                <path fill-rule="evenodd"
                  d="M10 12.5a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 .5.5v2a.5.5 0 0 0 1 0v-2A1.5 1.5 0 0 0 9.5 2h-8A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-2a.5.5 0 0 0-1 0v2z" />
                <path fill-rule="evenodd"
                  d="M15.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 0 0-.708.708L14.293 7.5H5.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0 .708.708l3-3z" />
              </svg>
            </button>
            } @else {
            <button type="button" class="btn btn-sm btn-outline-success" (click)="login()" title="Login">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                <path fill-rule="evenodd"
                  d="M6 3.5a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-2a.5.5 0 0 0-1 0v2A1.5 1.5 0 0 0 6.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2h-8A1.5 1.5 0 0 0 5 3.5v2a.5.5 0 0 0 1 0v-2z" />
                <path fill-rule="evenodd"
                  d="M11.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 1 0-.708.708L10.293 7.5H1.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0 .708.708l3-3z" />
              </svg>
            </button>
            }
          </div>

          <!-- Separate buttons on desktop -->
          <button type="button" class="btn btn-sm btn-outline-primary d-none d-md-inline-flex" (click)="goHome()"
            title="Home">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
              <path
                d="M8.354 1.146a.5.5 0 0 0-.708 0l-6 6a.5.5 0 1 0 .708.708L2 7.207V14.5A1.5 1.5 0 0 0 3.5 16h2A1.5 1.5 0 0 0 7 14.5V11h2v3.5A1.5 1.5 0 0 0 10.5 16h2a1.5 1.5 0 0 0 1.5-1.5V7.207l.646.647a.5.5 0 0 0 .708-.708l-6-6z" />
            </svg>
          </button>
          @if (showRoleMenu()) {
          <a role="button" class="btn btn-sm btn-outline-success d-none d-md-inline-flex"
            [routerLink]="['/tsic/role-selection']" (click)="onSwitchRole($event)" title="Switch Role">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
              <path d="M1 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1H1zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6z" />
              <path fill-rule="evenodd"
                d="M13.5 5a.5.5 0 0 1 .5.5V7h1.5a.5.5 0 0 1 0 1H14v1.5a.5.5 0 0 1-1 0V8h-1.5a.5.5 0 0 1 0-1H13V5.5a.5.5 0 0 1 .5-.5z" />
            </svg>
          </a>
          }
          <button type="button" class="btn btn-sm btn-outline-secondary d-none d-md-inline-flex" (click)="toggleTheme()"
            title="Toggle Theme">
            @if (themeService.theme() === 'light') {
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
              <path
                d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z" />
            </svg>
            } @else {
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
              <path
                d="M8 11a3 3 0 1 1 0-6 3 3 0 0 1 0 6zm0 1a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z" />
            </svg>
            }
          </button>
          @if (isAuthenticated()) {
          <button type="button" class="btn btn-sm btn-outline-danger d-none d-md-inline-flex" (click)="logout()"
            title="Logout">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
              <path fill-rule="evenodd"
                d="M10 12.5a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 .5.5v2a.5.5 0 0 0 1 0v-2A1.5 1.5 0 0 0 9.5 2h-8A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-2a.5.5 0 0 0-1 0v2z" />
              <path fill-rule="evenodd"
                d="M15.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 0 0-.708.708L14.293 7.5H5.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0 .708.708l3-3z" />
            </svg>
          </button>
          } @else {
          <button type="button" class="btn btn-sm btn-outline-success d-none d-md-inline-flex" (click)="login()"
            title="Login">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
              <path fill-rule="evenodd"
                d="M6 3.5a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-2a.5.5 0 0 0-1 0v2A1.5 1.5 0 0 0 6.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2h-8A1.5 1.5 0 0 0 5 3.5v2a.5.5 0 0 0 1 0v-2z" />
              <path fill-rule="evenodd"
                d="M11.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 1 0-.708.708L10.293 7.5H1.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0 .708.708l3-3z" />
            </svg>
          </button>
          }
        </div>
      </div>
    </div>
  </div>
</header>

<!-- Horizontal Navigation Menu (desktop only) -->
@if (menus() && menus().length > 0) {
<nav class="navbar navbar-expand-lg d-none d-lg-block">
  <div class="container-fluid">
    <ul class="navbar-nav">
      @for (item of menus(); track item.menuItemId) {
      <li class="nav-item" [class.dropdown]="hasChildren(item)">
        @if (hasChildren(item)) {
        <!-- Parent with dropdown -->
        <a class="nav-link dropdown-toggle" href="#" role="button" [class.expanded]="isExpanded(item.menuItemId)"
          (click)="$event.preventDefault(); toggleExpanded(item.menuItemId)">
          @if (item.iconName) {
          <i class="bi bi-{{ item.iconName }} me-1"></i>
          }
          {{ item.text }}
        </a>
        <!-- Dropdown menu -->
        <ul class="dropdown-menu" [class.show]="isExpanded(item.menuItemId)">
          @for (child of item.children; track child.menuItemId) {
          <li>
            @if (isExternalLink(child)) {
            <a class="dropdown-item" [href]="getLink(child)" [target]="child.linkTarget || '_self'">
              @if (child.iconName) {
              <i class="bi bi-{{ child.iconName }} me-2"></i>
              }
              {{ child.text }}
            </a>
            } @else if (getLink(child)) {
            <a class="dropdown-item" [routerLink]="getLink(child)" routerLinkActive="active">
              @if (child.iconName) {
              <i class="bi bi-{{ child.iconName }} me-2"></i>
              }
              {{ child.text }}
            </a>
            } @else {
            <span class="dropdown-item disabled">
              @if (child.iconName) {
              <i class="bi bi-{{ child.iconName }} me-2"></i>
              }
              {{ child.text }}
            </span>
            }
          </li>
          }
        </ul>
        } @else {
        <!-- Standalone item -->
        @if (isExternalLink(item)) {
        <a class="nav-link" [href]="getLink(item)" [target]="item.linkTarget || '_self'">
          @if (item.iconName) {
          <i class="bi bi-{{ item.iconName }} me-1"></i>
          }
          {{ item.text }}
        </a>
        } @else if (getLink(item)) {
        <a class="nav-link" [routerLink]="getLink(item)" routerLinkActive="active">
          @if (item.iconName) {
          <i class="bi bi-{{ item.iconName }} me-1"></i>
          }
          {{ item.text }}
        </a>
        } @else {
        <span class="nav-link disabled">
          @if (item.iconName) {
          <i class="bi bi-{{ item.iconName }} me-1"></i>
          }
          {{ item.text }}
        </span>
        }
        }
      </li>
      }
    </ul>
  </div>
</nav>
}

<!-- Main Content -->
<main class="container-fluid py-4">
  <div class="row">
    <!-- Sidebar Navigation (mobile/tablet only) -->
    @if (menus() && menus().length > 0) {
    <aside class="d-lg-none"
      [class]="sidebarOpen() ? 'col-md-3 mb-4 sidebar-mobile sidebar-open' : 'mb-4 sidebar-mobile sidebar-collapsed'">
      <!-- Overlay for mobile sidebar (click to close) -->
      <div class="sidebar-overlay d-md-none" [class.show]="sidebarOpen()" (click)="toggleSidebar()"></div>

      <!-- Sidebar content -->
      <div class="sidebar-content">
        <app-menus [menus]="menus()" [loading]="menusLoading()" [error]="menusError()">
        </app-menus>
      </div>
    </aside>
    }

    <!-- Content Area (right or full width if no menu) -->
    <div [class]="menus() && menus().length > 0 ? (sidebarOpen() ? 'col-md-9 col-lg-10' : 'col-12') : 'col-12'">
      <router-outlet></router-outlet>
    </div>
  </div>
</main>